branches:
  only:
  - master

os:
  - linux
  - windows
  - osx

language: python

addons:

  #linux
  apt:
    update: true
    packages:
      - desktop-file-utils
      - p7zip-full

  #osx
  homebrew:
    update: true
    packages:
      - p7zip

script:
  - python .travis.py

  # install D

  ## linux
  # - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo snap install ldc2 --classic --channel=edge; fi
  # - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo snap install dmd --classic; fi
  # - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo snap install dub --classic; fi


  ### deb
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then cd Tools/deb; fi
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then bash build_deb_cli.bash; fi
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then bash build_deb_gtk.bash; fi
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then cd ../../; fi

  ### AppImage
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then cd Tools/AppImage; fi
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then bash build_appimage_gtk.bash; fi
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then cd ../../; fi

before_deploy:
 - git config --local user.name "Federico Santamorena"
 - git config --local user.email "federico@santamorena.me"
 - export DRILL_VERSION=$(python -c "import sys, json; f = open('dub.json'); print(json.load(f)['version']); f.close()") 

deploy:
  provider: releases
  skip_cleanup: true
  draft: false
  prerelease: true
  name: $DRILL_VERSION
  body: $TRAVIS_COMMIT_MESSAGE
  target_commitish: $TRAVIS_COMMIT
  file_glob: true
  api_key:
    secure: $GITHUB_TOKEN
  file: 
    - Output/*.*
  on:
    repo: yatima1460/Drill

notifications:
  email:
    on_success: never
    on_failure: always

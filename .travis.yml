os:
- linux
- windows
language: bash
before_script:
- git config --local user.name "Federico Santamorena"
- git config --local user.email "federico@santamorena.me"
- export TRAVIS_TAG=${TRAVIS_TAG:-$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)}
- git tag $TRAVIS_TAG
- echo -n $TRAVIS_TAG > DRILL_VERSION
- cat DRILL_VERSION
script:

#windows
- if [ "$TRAVIS_OS_NAME" == "windows" ]; then wget http://downloads.dlang.org/nightlies/dmd-master/dmd.master.windows.7z; fi
- if [ "$TRAVIS_OS_NAME" == "windows" ]; then choco install zip; fi
- if [ "$TRAVIS_OS_NAME" == "windows" ]; then zip --version; fi
- if [ "$TRAVIS_OS_NAME" == "windows" ]; then choco install 7zip; fi
- if [ "$TRAVIS_OS_NAME" == "windows" ]; then 7z x dmd.master.windows.7z; fi
- if [ "$TRAVIS_OS_NAME" == "windows" ]; then git clone https://github.com/yatima1460/GTK-for-Windows-Runtime-Environment-Installer.git; fi
- if [ "$TRAVIS_OS_NAME" == "windows" ]; then dmd2/windows/bin/dub build -c CLI --build=release --parallel --force; fi
- if [ "$TRAVIS_OS_NAME" == "windows" ]; then zip -r Drill-CLI-Windows.zip assets Drill-CLI.exe DRILL_VERSION GTK-for-Windows-Runtime-Environment-Installer/gtk-nsis-pack/bin/; fi
- if [ "$TRAVIS_OS_NAME" == "windows" ]; then dmd2/windows/bin/dub build -c GTK --build=release --parallel --force; fi
- if [ "$TRAVIS_OS_NAME" == "windows" ]; then zip -r Drill-GTK-Windows.zip assets Drill-GTK.exe DRILL_VERSION GTK-for-Windows-Runtime-Environment-Installer/gtk-nsis-pack/bin/; fi

#linux
- if [ "$TRAVIS_OS_NAME" == "linux" ]; then sudo apt update; fi
- if [ "$TRAVIS_OS_NAME" == "linux" ]; then sudo apt install desktop-file-utils; fi
- if [ "$TRAVIS_OS_NAME" == "linux" ]; then curl -fsS https://dlang.org/install.sh | bash -s dmd; fi
- if [ "$TRAVIS_OS_NAME" == "linux" ]; then source ~/dlang/dmd-2.086.0/activate; fi
- if [ "$TRAVIS_OS_NAME" == "linux" ]; then dub build -c CLI --build=release --parallel --force; fi
- if [ "$TRAVIS_OS_NAME" == "linux" ]; then zip -r Drill-CLI-Debian-Executable.zip assets Drill-CLI DRILL_VERSION; fi
- if [ "$TRAVIS_OS_NAME" == "linux" ]; then cd tools/appimage && sh cli.sh && cd ../../; fi
- if [ "$TRAVIS_OS_NAME" == "linux" ]; then dub build -c GTK --build=release --parallel --force; fi
- if [ "$TRAVIS_OS_NAME" == "linux" ]; then zip -r Drill-GTK-Debian-Executable.zip assets Drill-GTK DRILL_VERSION; fi
- if [ "$TRAVIS_OS_NAME" == "linux" ]; then cd tools/appimage && sh gtk.sh && cd ../../; fi
# before_deploy: if ! [[ $TRAVIS_TAG ]]; then git config --local user.name "Federico
#   Santamorena" && git config --local user.email "federico@santamorena.me" && export
#   TRAVIS_TAG=${TRAVIS_TAG:-$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)} && git
#   tag $TRAVIS_TAG; fi
deploy:
  provider: releases
  api_key:
    secure: $GITHUB_TOKEN
  file: 
    - tools/appimage/Drill-GTK.AppImage
    - tools/appimage/Drill-CLI.AppImage
    - tools/Drill-GTK-Debian-Executable.zip
    - tools/Drill-CLI-Debian-Executable.zip
    - Drill-CLI-Windows.zip
    - Drill-GTK-Windows.zip
  on:
    repo: yatima1460/Drill

notifications:
  email:
    on_success: never
    on_failure: always


# 

variables:
  dmd_version: 2.087.1

trigger:
  branches:
    include:
    - master

pr: none


stages:
- stage: CLI_Unittests
  condition: always()
  dependsOn: []
  jobs:
  - template: job_linux_cli_unittest.yml
  - template: job_windows_cli_unittest.yml
  - template: job_osx_cli_unittest.yml
  
- stage: GTK_Unittests
  condition: always()
  dependsOn: []
  jobs:
  - template: job_linux_gtk_unittest.yml
  - template: job_windows_gtk_unittest.yml
  - template: job_osx_gtk_unittest.yml

- stage: CLI_Releases
  condition: always()
  dependsOn: [CLI_Unittests]
  jobs:
  - template: job_linux_cli_release.yml
  - template: job_windows_cli_release.yml
  - template: job_osx_cli_release.yml

- stage: GTK_Releases
  condition: always()
  dependsOn: [GTK_Unittests]
  jobs:
  - template: job_linux_gtk_release.yml
  - template: job_windows_gtk_release.yml
  - template: job_osx_gtk_release.yml

  - job: Linux_GTK_AppImage_Create
    pool:
      name: Hosted Ubuntu 1604
    steps:
    - template: dub_install_linux.yml
    - template: gtk_install_linux.yml
    - script: dub build -c GTK -b release --arch=x86_64
      displayName: GTK Release
    - template: appimage_create.yml
    - script: curl -T Drill-release-x86_64.AppImage -uyatima1460:$(BINTRAY_API_KEY) https://api.bintray.com/content/yatima1460/Drill_Beta/AppImage_Beta/$(Build.BuildNumber)/Drill-$(Build.BuildNumber)-x86_64.AppImage